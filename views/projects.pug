extends layout.pug

block content
    link(rel='stylesheet', href='../../css/common.css')
    script(src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js')
    script(src='https://code.jquery.com/jquery-3.2.1.min.js', integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=', crossorigin='anonymous')
    div.content-wrapper
        nav(style="--bs-breadcrumb-divider: '>';" aria-label='breadcrumb')
            ol.breadcrumb
                li.breadcrumb-item.active(aria-current='page') Project
        form.input-form
            h1 Projects
            button.btn.btn-right.btn-success.btn-block.btn-create_project(type='submit') Create Project
        .cards
            .card
                .card-header
                    .card-title 
                    .card-tools
                .card-body.p-0
                    table.table
                        thead
                            tr
                                //- th(style='width: 10px') #
                                th ID
                                th Name
                                th Environments
                                th Collections
                                th Edit 
                                //- th(style='width: 40px') Label
                        tbody
                            if userProjects
                                - let i = 0
                                while i < userProjects.length
                                    tr 
                                        td #{userProjects[i]._id}
                                        td #{userProjects[i].project_name}
                                        td 
                                            button.btn.btn-secondary.btn-details(type='submit') details
                                        td 
                                            button.btn.btn-warning.btn-details(type='submit') View All
                                        td 
                                            button.btn.btn-primary.btn-modify(type='submit') modify
                                            button.btn.btn-danger.btn-delete(type='submit' id=`${userProjects[i]._id}`) delete
                                    - i++
                            //- tr
                            //-     td 1.
                            //-     td Update software
                            //-     td
                            //-         .progress.progress-xs
                            //-             .progress-bar.progress-bar-danger(style='width: 55%')
                            //-     td
                            //-         span.badge.bg-danger 55%
    script.
        $('.btn-create_project').on('click', function(event) {
            console.log('create_project clicked')
            event.preventDefault();
            window.location.assign('./editproject');
        })

        $('.btn-delete').on('click', function(event) {
            console.log('delete_project clicked')
            event.preventDefault();

            console.log('this.id: ', this.id)
            const projectId = this.id;

            axios({
                method: 'delete',
                url: 'http://localhost:3001/api/1.0/editproject',
                data: {
                    //- userEmail: 'serval_meow@gmail.com',
                    projectId: projectId,
                },
                headers: {'Content-Type': 'application/json'}
            })
            .then((response) => {
                if (response.status === 200) {
                    //- console.log('response.status: ', response.status);
                    alert('delete project successfully')
                    //- window.location.assign('./testresult');
                    // TODO: settimeout and let page return to show all projects
                }
            })
            .catch((error) => {
                console.log('in error');
                console.log('catch: ', error)
                alert('delete project error')
            })
        })
            //- div.card.card-project
            //-     form.input-form
            //-         div.form-group
            //-             label(for='exampleFormControlInput1') Create New API 
            //-             select#exampleFormControlSelect1.form-control.text-muted.select_project
            //-                 option(value='' selected='' disabled='' hidden='') Select Project
            //-             select#exampleFormControlSelect1.form-control.text-muted.select_collection
            //-                 option(value='' selected='' disabled='' hidden='') Select Collection
            //-             input#exampleFormControlInput1.form-control.create_collection(type='url' placeholder='API name')
            //-         button.btn.btn-outline-info.btn-block.btn-create_api(type='submit') Create API
