extends layout.pug

block content 
  link(rel='stylesheet', href='../../css/common.css')
  script(src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js')
  //- script(src='https://code.jquery.com/jquery-3.2.1.min.js', integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=', crossorigin='anonymous')
  script(src='/src/plugins/jquery.js')
  script(src='/src/plugins/jquery.flot.js')
  script(src='/src/plugins/jquery.flot.pie.js')

  -function prettyDate(dateString){
      //if it's already a date object and not a string you don't need this line:
      -var date = new Date(dateString);
      -var d = date.getDate();
      -var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
      -var m = monthNames[date.getMonth()];
      -var y = date.getFullYear();
      -return d+' '+m+' '+y;
  -}

  div.content-wrapper
    .input-form
      h1.display-4 Report Details

      .basic-info 
        .basic-text 
          .card 
            .card-header Information
            .card-body 
              #info-text(style='height: 300px; padding: 0px; position: relative;')
                dl(style='align-items: center; border-bottom: 1px solid rgba(0, 0, 0, 0.3); display: flex; justify-content: space-between;')
                  dt API ID
                  dd #{reportResponse[0].api_id}
                dl(style='align-items: center; border-bottom: 1px solid rgba(0, 0, 0, 0.3); display: flex; justify-content: space-between;')
                  dt Scenario ID
                  dd #{reportResponse[0].scenario_id}
                dl(style='align-items: center; border-bottom: 1px solid rgba(0, 0, 0, 0.3); display: flex; justify-content: space-between;')
                  dt Example ID
                  dd #{reportResponse[0].example_id}

        .pass-rate-pie 
          .card
            .card-header Pass Rate
            .card-body
              #donut-chart(style='height: 300px; padding: 0px; position: relative;')
                canvas.flot-base(width='764' height='300' style='direction: ltr; position: absolute; left: 0px; top: 0px; width: 764.5px; height: 300px;')
                canvas.flot-overlay(width='764' height='300' style='direction: ltr; position: absolute; left: 0px; top: 0px; width: 764.5px; height: 300px;')
                span#pieLabel0.pieLabel(style='position: absolute; top: 69.5px; left: 440.203px;')
                  div(style='font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;')
                    | Series2
                    br
                    | 30%
                span#pieLabel1.pieLabel(style='position: absolute; top: 209.5px; left: 418.203px;')
                  div(style='font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;')
                    | Series3
                    br
                    | 20%
                span#pieLabel2.pieLabel(style='position: absolute; top: 128.5px; left: 259.203px;')
                  div(style='font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;')
                    | Series4
                    br
                    | 50%

        .examples-histogram
          .card
            .card-header  Examples
            .card-body
              #bar-chart(style='height: 300px; padding: 0px; position: relative;')
                canvas.flot-base(width='764' height='300' style='direction: ltr; position: absolute; left: 0px; top: 0px; width: 764.5px; height: 300px;')
                canvas.flot-overlay(width='764' height='300' style='direction: ltr; position: absolute; left: 0px; top: 0px; width: 764.5px; height: 300px;')
                .flot-svg(style='position: absolute; top: 0px; left: 0px; height: 100%; width: 100%; pointer-events: none;')
                  svg(style='width: 100%; height: 100%;')
                    g.flot-x-axis.flot-x1-axis.xAxis.x1Axis(style='position: absolute; inset: 0px;')
                      text.flot-tick-label.tickLabel(x='161.3224431818182' y='294' style='position: absolute; text-align: center;') Total
                      text.flot-tick-label.tickLabel(x='298.43039772727275' y='294' style='position: absolute; text-align: center;') Passed
                      text.flot-tick-label.tickLabel(x='430.94460227272725' y='294' style='position: absolute; text-align: center;') Failed
                      text.flot-tick-label.tickLabel(x='560.4822443181819' y='294' style='position: absolute; text-align: center;') Pending

                    g.flot-y-axis.flot-y1-axis.yAxis.y1Axis(style='position: absolute; inset: 0px;')
                      text.flot-tick-label.tickLabel(x='8.953125' y='269' style='position: absolute; text-align: right;') 0
                      text.flot-tick-label.tickLabel(x='8.953125' y='205.5' style='position: absolute; text-align: right;') 5
                      text.flot-tick-label.tickLabel(x='1' y='15' style='position: absolute; text-align: right;') 20
                      text.flot-tick-label.tickLabel(x='1' y='142' style='position: absolute; text-align: right;') 10
                      text.flot-tick-label.tickLabel(x='1' y='78.5' style='position: absolute; text-align: right;') 15

      .card
        .card-header Progress
        .card-body
          .progress
            .progress-bar.bg-success(role='progressbar' style='width: 15%' aria-valuenow='15' aria-valuemin='0' aria-valuemax='100') 15%
            .progress-bar.bg-warning.text-dark(role='progressbar' style='width: 30%' aria-valuenow='30' aria-valuemin='0' aria-valuemax='100') 30%
            .progress-bar.bg-danger(role='progressbar' style='width: 20%' aria-valuenow='20' aria-valuemin='0' aria-valuemax='100') 20%

          .progress-bar-description
            div
              br
              .badge.bg-success(style='float: right;') Finished 15%
              br
              .badge.bg-warning.text-dark(style='float: right;') Pending 30%
              br
              .badge.bg-danger(style='float: right;') Failed 20%


      .card
        .card-header Test Example Details
        .card-body.p-0
          if reportResponse[0]._id
            table.table 
              thead
                tr
                  th(scope='col') Time
                  th(scope='col') Scenario Title
                  th(scope='col') Example
                  th(scope='col') Result 
                  th(scope='col') Expected Result
                  th(scope='col') Real Result
                  th(scope='col') Request Length
              tbody
              - let i = 0
              while i < reportResponse.length
                tr
                  td #{prettyDate(reportResponse[i].request_time)}
                  td #{reportResponse[i].scenario_id}
                  td #{reportResponse[i].example_id}
                  if reportResponse[i].pass
                    td.result-text(style='color: green;') #{reportResponse[i].pass.toString().toUpperCase()}
                  else 
                    td.result-text(style='color: red;') #{reportResponse[i].pass.toString().toUpperCase()}
                  td #{reportResponse[i].response_status}
                  td #{reportResponse[i].response_status}
                  th #{reportResponse[i].request_time_length}
                - i++

  script.
    function labelFormatter(label, series) {
      return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">'
        + label
        + '<br>'
        + Math.round(series.percent) + '%</div>'
    }

    $(function () {

      let donutData = [
        {
          label: 'Series2',
          data : 30,
          color: '#3c8dbc'
        },
        {
          label: 'Series3',
          data : 20,
          color: '#0073b7'
        },
        {
          label: 'Series4',
          data : 50,
          color: '#00c0ef'
        }
      ]
      $.plot('#donut-chart', donutData, {
        series: {
          pie: {
            show       : true,
            radius     : 1,
            innerRadius: 0.5,
            label      : {
              show     : true,
              radius   : 2 / 3,
              formatter: labelFormatter,
              threshold: 0.1
            }

          }
        },
        legend: {
          show: false
        }
      })

      /*
      * BAR CHART
      * ---------
      */
      let bar_data = {
        data : [[1,10], [2,8], [3,4], [4,13]],
        bars: { show: true }
      }
      $.plot('#bar-chart', [bar_data], {
        grid  : {
          borderWidth: 1,
          borderColor: '#f3f3f3',
          tickColor  : '#f3f3f3'
        },
        series: {
          bars: {
            show: true, barWidth: 0.5, align: 'center',
          },
        },
        colors: ['#3c8dbc'],
        xaxis : {
          ticks: [[1,'January'], [2,'February'], [3,'March'], [4,'April'], [5,'May'], [6,'June']]
        }
      })
      /* END BAR CHART */
    })
