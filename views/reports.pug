extends layout.pug

block content 
  link(rel='stylesheet', href='../../css/common.css')
  script(src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js')
  script(src='https://code.jquery.com/jquery-3.2.1.min.js', integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=', crossorigin='anonymous')
  
  // src: https://stackoverflow.com/questions/16922625/trying-to-format-a-date-on-jade-template
  -function prettyDate(dateString){
      //if it's already a date object and not a string you don't need this line:
      -var date = new Date(dateString);
      -var d = date.getDate();
      -var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
      -var m = monthNames[date.getMonth()];
      -var y = date.getFullYear();
      -return d+' '+m+' '+y;
  -}

    main.main-content(role='main')
        .container-fluid
            .row.justify-content-center
                .col-12
                  .input-form
                    h1(style='font-family: PF Tempesta Seven Extended, sans-serif; font-size: 2rem;') Results
                    if reportData[0].projectName
                      h1.display-6 #{reportData[0].projectName.toUpperCase()}
                    .card
                      .card-body.p-0
                        table.table 
                          if !reportData[0].projectName
                            div(style='display: flex; justify-content: center;')
                              .text-muted.display-6(style='padding-top: 20px') No reports yet. Run your first test with serval!
                          else
                              thead
                                tr
                                  th.text-dark(scope='col' style='width: 200px') Date
                                  th.text-dark(scope='col' style='width: 150px') Type
                                  th.text-dark(scope='col' style='width: 150px') Status
                                  th.text-dark(scope='col' style='width: 600px') Title
                                  //- th.text-dark(scope='col' style='width: 150px') Pass Rate 
                                  //- th.text-dark(scope='col' style='width: 150px') Examples
                                  //- th.text-dark(scope='col' style='width: 200px') Average Time
                                  th.text-dark(scope='col') Operation
                              tbody
                              - let i = 0
                              while i < reportData.length
                                tr
                                  td #{prettyDate(reportData[i].create_time)}
                                  td 
                                    if reportData[i].report_info.report_type === 'scenario'
                                      h1.display-6.badge(style='font-size: 120%; background-color: #809A6F') SCENARIO
                                    else if reportData[i].report_info.report_type === 'api'
                                      h1.display-6.badge(style='font-size: 120%; background-color: #A25B5B') API
                                    else if reportData[i].report_info.report_type === 'collection'
                                      h1.display-6.badge(style='font-size: 120%; background-color: #CC9C75') COLLECTION
                                  td.report-title.list-inline
                                    if reportData[i].finished === true 
                                      h1.badge.bg-success.text-dark.result-badge(style='font-family: PF Tempesta Seven Extended, sans-serif; font-size: 90%;') DONE
                                    else 
                                      h1.badge.bg-warning.text-dark.result-badge(style='font-family: PF Tempesta Seven Extended, sans-serif; font-size: 90%;') RUNNING
                                  td.report-title.list-inline
                                    each element in reportData[i].report_title
                                      h1.list-inline-item.badge.bg-light.text-dark(style='font-size: 110%;')= element
                                  //- td 
                                  //-   if reportData[i].finished && reportsDetail[i].passRate
                                  //-     p= reportsDetail[i].passRate
                                  //-   else 
                                  //-     h4.badge.bg-warning.result-badge(style='font-family: Pixeloid Sans, sans-serif;') PENDING
                                  //- td 
                                  //-   if reportData[i].finished && reportsDetail[i].passExamples
                                  //-     p= reportsDetail[i].passExamples
                                  //-   else 
                                  //-     h4.badge.bg-warning.result-badge(style='font-family: Pixeloid Sans, sans-serif;') PENDING
                                  //- td 
                                  //-   if reportData[i].finished && reportsDetail[i].averageTime
                                  //-     p= reportsDetail[i].averageTime
                                  //-   else 
                                  //-     h4.badge.bg-warning.result-badge(style='font-family: Pixeloid Sans, sans-serif;') PENDING
                                  td 
                                    button.btn.btn-primary.btn-report-detail(type='submit' id=`${reportData[i]._id}`) Detail
                                - i++


  script.
    $('.btn-report-detail').on('click', function(event) {
        console.log('view report-detail clicked')
        event.preventDefault();
        const reportId = this.id;

        window.location.assign(`./reportdetail?reportid=${reportId}`);
    })